{% sw_extends '@Storefront/storefront/page/product-detail/tabs.html.twig' %}

{% set tsChannelId = context.salesChannel.id ?? null %}
{% set activeLanguageIsoCode = page.header.activeLanguage.translationCode.code ?? null %}
{% set tsChannelRef = tsChannelId ~ '.' ~ activeLanguageIsoCode %}
{% set widgetLocationId = "wdg-loc-pp" %}

{% block page_product_detail_tabs_navigation_review %}
    {{ parent() }}

    {% if tsChannelId is not null %}
        {% if tsConfig[tsChannelId][activeLanguageIsoCode].widgets is defined and expectedMapping[tsChannelRef] === tsConfig[tsChannelId][activeLanguageIsoCode].widgets.eTrustedChannelRef %}
            {% set tsChannelConfig = tsConfig[tsChannelId][activeLanguageIsoCode] %}
            {% set flag = 0 %}
            {% for widget in tsConfig[tsChannelId][activeLanguageIsoCode].widgets.children.0.children %}
                {% if widget.widgetLocation.id == widgetLocationId %}
                    {% set flag = 1 %}
                {% endif %}
            {% endfor %}

            {% if flag %}
                <!-- added by Trusted Shops app: Start -->
                <li class="nav-item">
                    <a class="nav-link product-detail-tab-navigation-link"
                       id="ts-review-tab"
                    data-toggle="tab"
                    data-bs-toggle="tab"
                    {# backwards compatibility #}
                    data-offcanvas-tabs="true"
                    {# backwards compatibility #}
                    data-off-canvas-tabs="true"
                    href="#ts-review-tab-pane"
                    aria-controls="ts-review-tab-pane"
                    aria-selected="true">
                    {{ "trustedShopsApp.productDetail.reviewTab.name"|trans|sw_sanitize }}
                    <span class="product-detail-tab-navigation-icon">
                        {% sw_icon 'arrow-medium-right' style {'pack':'solid'} %}
                    </span>
                    </a>
                </li>
                <!-- End -->
            {% endif %}
        {% endif %}
    {% endif %}
{% endblock %}

{% block page_product_detail_tabs_content_review %}
    {{ parent() }}
    {% if tsChannelId is not null %}
        {% if tsConfig[tsChannelId][activeLanguageIsoCode].widgets is defined and expectedMapping[tsChannelRef] === tsConfig[tsChannelId][activeLanguageIsoCode].widgets.eTrustedChannelRef %}
            {% set product = page.product %}

            {% if page.product.parentId %}
                {% if page.extensions.tsParentProduct is defined and not null %}
                    {% set product = page.extensions.tsParentProduct %}
                {% endif %}
            {% endif %}
            <!-- added by Trusted Shops app: Start -->
            <div class="tab-pane fade show"
                 id="ts-review-tab-pane"
                 role="tabpanel"
                 aria-labelledby="ts-review-tab">
                {% sw_include '@Storefront/storefront/page/product-detail/offcanvas/ts-description.html.twig' %}
            </div>
            <!-- End -->
        {% endif %}
    {% endif %}
{% endblock %}
